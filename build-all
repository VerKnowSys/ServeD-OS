#!/bin/sh

. /usr/share/sofin/loader

unset CXX
unset CPP
unset CC
unset PKG_CONFIG_PATH
unset MANPATH
unset LDFLAGS
unset CXXFLAGS
unset CFLAGS
unset MAIL
unset MAILCHECK
unset PATH
unset CDPATH
unset LANG
unset LANGUAGE
unset LC_TIME
unset LC_NUMERIC
unset LC_MONETARY
unset LC_MESSAGES
unset LC_CTYPE
unset LC_COLLATE
unset LC_ALL
unset KEYTIMEOUT
unset FIGNORE


LANG=C
SHELL=/bin/sh
PATH=/Software/Git/exports:/bin:/usr/bin:/sbin:/usr/sbin:/usr/libexec
s disable


# HardenedBSD base branch:
# VERSION="$1"
# if [ "${VERSION}" = "" ]; then
#     echo "No version specified! Specify f.e.: 0.99.10"
#     exit 1
# fi
OS_VER="11.0" # 10.2
MAIN_REPOSITORY="https://github.com/HardenedBSD/hardenedBSD.git"
CURRENT_BRANCH="hardened/11-stable/master"
# MAIN_REPOSITORY="https://github.com/hardenedbsd/hardenedbsd-stable/"
DESTINATION="dmilith@served.verknowsys.com:/Users/dmilith/ServeD/Web/"
BASE_NAME="ServeD-OS-Base"
if [ -z "${ARCH}" ]; then
    ARCH="$(uname -m)"
fi

cp -v etc/make.conf /etc/
cp -v etc/src.conf /etc/

# test -z "${DEVEL}" && \
#     git reset --hard
case ${ARCH} in
    arm)
        sed -i '' -e 's/^COPTFLAGS.*$/COPTFLAGS=-O2 -pipe -ffast-math -fno-strict-aliasing -mcpu=cortex-a7 -mfpu=neon-vfpv4 -mfloat-abi=hard/' etc/make.conf
        sed -i '' -e 's/^CPUTYPE.*$/CPUTYPE?=armv6/' etc/make.conf
        sed -i '' -e 's/^CFLAGS.*$/CFLAGS=-O2 -pipe -fno-omit-frame-pointer -fno-strict-aliasing -mcpu=cortex-a7 -mfpu=neon-vfpv4 -mfloat-abi=hard/' etc/make.conf
        ;;

    amd64|x86_64)
        ;;

    *)
        printf "Error: Architecture not supported: ${ARCH}.\n"
        exit 1
        ;;
esac

unset CC CPP CXX CFLAGS CXXFLAGS LDFLAGS MANPATH PATH PKG_CONFIG_PATH MAIL

export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/libexec
OS_NAME="FreeBSD"

# load functions for base build
. ./build-jail-base
. ./build-binary-snapshots

build_base "${OS_VER}" "${MAIN_REPOSITORY}" "${CURRENT_BRANCH}" "${ARCH}"
commit_snapshots_build "${BASE_NAME}" "${VERSION}" "${OS_VER}" "${DESTINATION}" "${ARCH}"

# test -z "${DEVEL}" && \
#     git reset --hard
